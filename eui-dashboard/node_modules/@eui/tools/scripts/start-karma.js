'use strict';

const spawn = require('cross-spawn');
const chalk = require('chalk');
const path = require('path');

// const karmaConfig = require('../config/karma.conf.pkg');
const utilsPackages = require('./utils/packages');

const pkgInfo = utilsPackages.getPackage();
const paths = require('../config/paths')(pkgInfo);

const args = process.argv.slice(2);
const nodeArgs = args.slice(pkgInfo.insidePkgFolder ? 0 : 1);

console.log('\n\n---------------------------------------------------');
console.log(chalk.cyan('Starting Karma'));
console.log('---------------------------------------------------');

const karmaArgs = ['start', path.resolve(paths.pkgDirectory + '/karma.conf.pkg.js')].concat(nodeArgs);

const result = spawn.sync('karma', karmaArgs, { stdio: 'inherit' });

if (result.status !== 0) {
    console.log('\n---------------------------------------------------');
    console.log(chalk.red('Karma Tests FAILED'));
    console.log('---------------------------------------------------');
    process.exit(1);
}
