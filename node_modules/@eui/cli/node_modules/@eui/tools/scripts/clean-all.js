'use strict';

const chalk = require('chalk');

const tools = require('./tools');

const { listPackages } = require('./utils/packages');

const packages = listPackages().filter(pkg => {
    if (!pkg.build) {
        return true;
    }
    return pkg.build.exec !== false;
});

if (packages.length > 0) {
    console.log('----------------------------------------------');
    console.log(chalk.cyan(`Cleaning ALL packages (total: ${packages.length})\n[${packages.map(p => p.name)}]`));
    console.log('----------------------------------------------');

    return packages.reduce((promise, pkg) => {
        return promise
            .then(() => tools.runScript(`eui-scripts clean-package ${pkg.name}`))
            .catch(() => {
                process.exit(1);
            });
    }, Promise.resolve());
}
