'use strict';
const chalk = require('chalk');

const config = require('../config/project');
const tools = require('./tools');
const { listPackages } = require('./utils/packages');

const args = process.argv.slice(2);

const packages = listPackages().filter(pkg => {
    if (!pkg.build) {
        return true;
    }
    return pkg.build.exec !== false;
});

if (packages.length > 0) {
    console.log('----------------------------------------------');
    console.log(chalk.cyan(`Extracting ALL packages git metadata (total: ${packages.length})\n[${packages.map(p => p.name)}]`));
    console.log('----------------------------------------------');

    return packages.reduce((promise, pkg) => {
        return promise
            .then(() => tools.runScript(`eui-scripts extract-git-metadata ${pkg.name} ${args.join(' ')}`));
    }, Promise.resolve())
    .catch((e) => {
        console.log(e);
        process.exit(1);
    });
}
