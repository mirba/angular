'use strict';

const spawn = require('cross-spawn');
const chalk = require('chalk');
const path = require('path');

const utilsPackages = require('./utils/packages');

const pkgInfo = utilsPackages.getPackage();
const paths = require('../config/paths')(pkgInfo);

const args = process.argv.slice(2);
const nodeArgs = args.slice(pkgInfo.insidePkgFolder ? 0 : 1);

console.log('\n\n---------------------------------------------------');
console.log(chalk.cyan('Building tests for package : ', `${pkgInfo.pkg}...`));
console.log('---------------------------------------------------');

const tscArgs = ['-p', path.resolve(paths.pkgDirectory + '/src/lib/tsconfig.spec.json')].concat(nodeArgs);

const result = spawn.sync('tsc', tscArgs, { stdio: 'inherit' });

if (result.status !== 0) {
    process.exit(result.status);
}

if (nodeArgs.indexOf('-w') < 0) {
    console.log(chalk.green('----> OK'));
}
