const tools = require('./tools');

function run(mainPackageJson) {
    console.log('----------------------------------------------');
    console.log('Updating packages version...');
    console.log('----------------------------------------------');

    const packagesFolder = 'src/packages';
    const packages = tools.getPackages(packagesFolder);

    if (packages.length === 0) {
        console.log('---no package found in ' + packagesFolder);
        return;
    }

    console.log('Updating packages version to : VERSION:' + mainPackageJson.version + ' - TAG:' + mainPackageJson.tag);

    return Promise.resolve()
                .then(() => {
                    return tools.replacePackagesVersion(packages, mainPackageJson.version, mainPackageJson.tag);
                })
                .then(() => {
                    console.log('----------------------------------------------');
                    console.log('Packages version updated');
                    console.log('----------------------------------------------');
                })
                .catch((e) => {
                    console.log('ERROR updating the packages version');
                    console.log(e);
                });

}

module.exports.run = run;
