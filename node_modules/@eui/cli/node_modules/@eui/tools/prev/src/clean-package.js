const tools = require('./tools');
const path = require('path');
const execa = require('execa');
const chalk = require('chalk');

function run(package, inputOpt) {

    const DEFAULT_OPTS = {
        packageRootPath: 'src/packages'
    };

    const opt = Object.assign(DEFAULT_OPTS, inputOpt);

    if (!package) {
        console.log(chalk.ref('ERROR : no package specified!!!'));
        return;
    }
    const rootFolder = path.join(process.cwd(), opt.packageRootPath, package);

    return Promise.resolve()
        .then(() => {
            console.log('\n\n---------------------------------------------------');
            console.log(chalk.cyan('Cleaning package : ', `${package}...`));
            console.log('---------------------------------------------------');
        })
        .then(() => {
            tools.runScript(`rimraf ${rootFolder}/out-tsc ${rootFolder}/dist`);
            console.log(chalk.green('----> OK'));
        })
        .catch((e) => {
            console.log('\n----------------------------------------------');
            console.log(chalk.red(" Build ERROR."));
            console.log('----------------------------------------------');
            console.log(e);
            process.exit(1);
        });

}

module.exports.run = run;
