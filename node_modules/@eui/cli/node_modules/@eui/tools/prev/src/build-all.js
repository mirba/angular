const path = require('path');
const execa = require('execa');
const tools = require('./tools');

function run() {
    console.log('----------------------------------------------');
    console.log('Building All packages :');
    console.log('----------------------------------------------');

    const packages = tools.getPackages();

    if (packages.length === 0) {
        return;
    }

    return Promise.resolve().then(() => {
        return packages.reduce((promise, item) => {
            return promise.then(() => {
                return execa('node', [path.join(__dirname, '/build-package.js'), item.package], { stdio: 'inherit' });
            });
        }, Promise.resolve());
    })
    .then(() => {
        console.log('--> ALL packages built successfully!');
    })
    .catch((e) => {
        console.log(e);
        process.exit(1);
    });
}

module.exports.run = run;
