package eu.europa.ec.digit.eui.service;

import java.util.*;

import com.mysema.query.types.Predicate;
import eu.europa.ec.digit.eui.entity.QUser;
import eu.europa.ec.digit.eui.repository.UserPredicates;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;
import eu.europa.ec.digit.eui.entity.User;
import eu.europa.ec.digit.eui.repository.UserRepository;
import eu.europa.ec.digit.eui.common.dto.UserDTO;

@Service
public class UserService {

    @Autowired
    private UserRepository userRepository;

    public List<UserDTO> findAll(UserDTO searchUserDTO) {

        List<User> users = (List<User>) userRepository.findAll(UserPredicates.search(searchUserDTO));

        List<UserDTO> userDTOs = new ArrayList<UserDTO>();
        for (User u : users) {
            userDTOs.add(getUserDTO(u));
        }
        return userDTOs;
    }

    public UserDTO findOne(Integer id) {
        return getUserDTO(userRepository.findOne(id));
    }

    public UserDTO saveUser(UserDTO userDTO) {
        userRepository.save(getUser(userDTO));
        return userDTO;
    }

    public void deleteUser(Integer id) { userRepository.delete(id); }





    private UserDTO getUserDTO(User u) {
        UserDTO dto = null;
        if (u != null) {
            dto = new UserDTO(u.getId(), u.getName(), u.getFirstName(), u.getEmailAddress(), u.getBirthDate(), u.getUserType(), u.getPicture());
        }
        return dto;
    }

    private User getUser(UserDTO dto) {
        User u = null;
        if (dto != null) {
            u = new User(dto.getId(), dto.getName(), dto.getFirstName(), dto.getEmailAddress(), dto.getBirthDate(), dto.getUserType(), dto.getPicture());
        }
        return u;
    }


}
