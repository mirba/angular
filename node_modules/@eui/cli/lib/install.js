const childProcess = require("child_process");
const execSync = childProcess.execSync;
const path = require("path");
const tools = require('@eui/tools/scripts/tools');
const utils = require('./utils');
const chalk = require('chalk');

function start(cliConfig, targetPath, callback) {
console.log('here2');
    const wd = path.resolve(utils.getAngularPath(targetPath, cliConfig.appType, cliConfig.artifactId));

    console.log('');
    console.log('');
    console.log('*****************************************************');
    console.log(chalk.cyan(' Installing app dependencies... PLEASE WAIT....'));
    console.log('*****************************************************');

    if (cliConfig.useYarn && cliConfig.npmInstall) {
        try {
            if (!process.env.npm_config_registry.indexOf('ecdevops.eu')) {
                tools.remove(path.join(wd,'yarn.lock'));
            }
        } catch(e) {
            tools.remove(path.join(wd,'yarn.lock'));
        }
        execSync("yarn", {cwd: wd, stdio: "inherit"});
    }
    if (!cliConfig.useYarn && cliConfig.npmInstall) {
        execSync("npm install", {cwd: wd, stdio: "inherit"});
    }

    if (cliConfig.appSubType === 'extended') {
        console.log('');
        console.log('');
        console.log('*****************************************************');
        console.log(chalk.cyan(' Building modules... PLEASE WAIT....'));
        console.log('*****************************************************');

        execSync("npm run pkg:build-all", {cwd: wd, stdio: "inherit"});
    }

    console.log('');
    console.log('');
    console.log('*****************************************************************');
    console.log(chalk.cyan(' Starting eUI app... browser will open soon on localhost:4200'));
    console.log('*****************************************************************');

    execSync("npm start", {cwd: wd, stdio: "inherit"});
}

module.exports.start = start;
